<script>
  const songs = [
    { title: "Berpayung Tuhan", file: "https://github.com/duomamet/duomamet.github.io/raw/refs/heads/main/Nadin%20Amizah%20-%20Berpayung%20Tuhan%20(Official%20Lyric%20Video).mp3", cover: "https://raw.githubusercontent.com/duomamet/duomamet.github.io/refs/heads/main/Nadin%20amizah.jpg" },
    { title: "Tapi Diterima", file: "https://github.com/duomamet/duomamet.github.io/raw/refs/heads/main/Nadin%20Amizah%20-%20Tapi%20Diterima%20(Official%20Lyric%20Video).mp3", cover: "https://raw.githubusercontent.com/duomamet/duomamet.github.io/refs/heads/main/Nadin%20amizah.jpg" },
    { title: "Lagu 3", file: "audio3.mp3", cover: "cover3.jpg" }
  ];

  let currentIndex = 0;
  let isPlaying = false;
  const audio = document.getElementById('audioPlayer');
  const songTitle = document.getElementById('songTitle');
  const coverArt = document.getElementById('coverArt');
  const backgroundBlur = document.getElementById('backgroundBlur');
  const playPauseBtn = document.getElementById('playPauseBtn');
  const nextBtn = document.getElementById('nextBtn');
  const prevBtn = document.getElementById('prevBtn');
  const progressBar = document.getElementById('progressBar');
  const playlist = document.getElementById('playlist');
  const progressBarContainer = document.getElementById('progressBarContainer');

  function loadSong(index) {
    const song = songs[index];
    audio.src = song.file;
    songTitle.textContent = song.title;
    coverArt.style.backgroundImage = `url('${song.cover}')`;
    backgroundBlur.style.backgroundImage = `url('${song.cover}')`;
    document.title = song.title;  // Change web title to the song title
    highlightCurrentSong();
  }

  function playSong() {
    audio.play();
    isPlaying = true;
    playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
  }

  function pauseSong() {
    audio.pause();
    isPlaying = false;
    playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
  }

  function playPause() {
    if (isPlaying) {
      pauseSong();
    } else {
      playSong();
    }
  }

  function nextSong() {
    currentIndex = (currentIndex + 1) % songs.length;
    loadSong(currentIndex);
    playSong();
  }

  function prevSong() {
    currentIndex = (currentIndex - 1 + songs.length) % songs.length;
    loadSong(currentIndex);
    playSong();
  }

  function updateProgress() {
    if (audio.duration) {
      const progressPercent = (audio.currentTime / audio.duration) * 100;
      progressBar.style.width = `${progressPercent}%`;
    }
  }

  function highlightCurrentSong() {
    const items = document.querySelectorAll('.playlist-item');
    items.forEach((item, index) => {
      if (index === currentIndex) {
        item.classList.add('active-song');
      } else {
        item.classList.remove('active-song');
      }
    });
  }

  function loadPlaylist() {
    playlist.innerHTML = ''; // Clear previous playlist

    // Loop through songs and create playlist items
    songs.forEach((song, index) => {
      const div = document.createElement('div');
      div.className = 'playlist-item';
      div.textContent = song.title;
      
      // Add event listener to each song item in the playlist
      div.addEventListener('click', () => {
        currentIndex = index;
        loadSong(currentIndex);
        playSong();
      });

      // Highlight the currently playing song
      if (index === currentIndex) {
        div.classList.add('active-song');
      }

      playlist.appendChild(div);
    });
  }

  playPauseBtn.addEventListener('click', playPause);
  nextBtn.addEventListener('click', nextSong);
  prevBtn.addEventListener('click', prevSong);

  audio.addEventListener('timeupdate', updateProgress);
  audio.addEventListener('ended', nextSong);

  // Allow dragging to change progress (Mouse and Touch)
  function onDragMove(event) {
    const width = progressBarContainer.offsetWidth;
    const offsetX = (event.clientX || event.touches[0].clientX) - progressBarContainer.getBoundingClientRect().left;
    const progress = Math.min(Math.max(offsetX / width, 0), 1);
    progressBar.style.width = `${progress * 100}%`;
    audio.currentTime = progress * audio.duration;
  }

  function onDragEnd() {
    document.removeEventListener('mousemove', onDragMove);
    document.removeEventListener('mouseup', onDragEnd);
    document.removeEventListener('touchmove', onDragMove);
    document.removeEventListener('touchend', onDragEnd);
  }

  // Mouse Events
  progressBarContainer.addEventListener('mousedown', (event) => {
    document.addEventListener('mousemove', onDragMove);
    document.addEventListener('mouseup', onDragEnd);
  });

  // Touch Events
  progressBarContainer.addEventListener('touchstart', (event) => {
    document.addEventListener('touchmove', onDragMove);
    document.addEventListener('touchend', onDragEnd);
  });

  // Init (acak lagu ketika pertama kali dimuat)
  currentIndex = Math.floor(Math.random() * songs.length); // Pilih lagu acak
  loadSong(currentIndex);
  playSong();
  loadPlaylist();
</script>
